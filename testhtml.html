<!DOCTYPE html>
<html lang="en-us">

<head>

  <meta charset="UTF-8">
  <title>Trains</title>
  <link rel="stylesheet" type="text/css" href="assets/css/reset.css">

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7"
    crossorigin="anonymous">
  <!-- Custom CSS -->
  <link rel="stylesheet" type="text/css" href="assets/css/trains.css">
  <script src="javascript/trains.js"></script>
</head>

<body>

  <div class="container">

    <br>

    <!-- Jumbotron -->
    <div class="pageHeader">
      <h1 class="text-center">Train Time Tables</h1>
      <h2 class="text-center">ALL ABOARD!</h2>
    </div>
    <div class="row">

      <!-- Sign-Up Panel-->
      <div class="col-lg-12">
        <div class="panel panel-default">
          <div id="panelHeader" class="panel-heading">
            <h3 class="panel-title">Current Train Schedule</h3>
          </div>
          <div class="panel-body">

            <!-- Scheduled Trains-->

            <div class="rows rdetail">
              <div class="col-md-3">
                <h4>
                  <strong>Train Name</strong>
                </h4>
              </div>
              <div class="col-md-3">
                <h4>
                  <strong>Destination</strong>
                </h4>
              </div>
              <div class="col-md-2">
                <h4>
                  <strong>Frequency (min)</strong>
                </h4>
              </div>
              <div class="col-md-2">
                <h4>
                  <strong>Next Arrival</strong>
                </h4>
              </div>
              <div class="col-md-2">
                <h4>
                  <strong>Minutes Away</strong>
                </h4>
              </div>
            </div>
            <div class="rows" rdetail>
              <div Id="tname" class="col-md-3">
                <p>Disney Express</p>

              </div>
              <div Id="tDest" class="col-md-3">
                <p>EPCOT</p>
              </div>
              <div id="tFreq" class="col-md-2">
                <p>5</p>
              </div>
              <div id="nextArrive" class="col-md-2">
                <p>08:05</p>
              </div>
              <div id="minAway" class="col-md-2">
                <p>5</p>

              </div>
            </div>
            <div id="rdetail2" class="rows">
              <div Id="tname" class="col-md-3">
                <p>Disney Express</p>

              </div>
              <div Id="tDest" class="col-md-3">
                <p>Animal Kingdom</p>
              </div>
              <div id="tFreq" class="col-md-2">
                <p>5</p>
              </div>
              <div id="nextArrive" class="col-md-2">
                <p>08:10</p>
              </div>
              <div id="minAway" class="col-md-2">
                <p>10</p>

              </div>
            </div>

          </div>

        </div>

        <!-- jQuery -->
        <script src="https://code.jquery.com/jquery.js"></script>

        <!-- LINK TO FIREBASE GOES HERE -->
        <script src="https://www.gstatic.com/firebasejs/4.8.0/firebase.js"></script>
        <!-->Initialize Firebase -->
        <script>
          var trainName = 0;
          var trainDestination = "";
          var trainFrequency = 0;
          var firstTrainTime = 0;
          var timeAway = 0;
          var config = {
            apiKey: "AIzaSyCGRXvD88P3ZcGPBE4mgYjK-zMGZ3FNTtE",
            authDomain: "train-schedules-5b28f.firebaseapp.com",
            databaseURL: "https://train-schedules-5b28f.firebaseio.com",
            projectId: "train-schedules-5b28f",
            storageBucket: "train-schedules-5b28f.appspot.com",
            messagingSenderId: "486424654375"
          };
          firebase.initializeApp(config);
          var db = firebase.database();
          //====== capture submit button ====
          $("#add-train-button").on("click", function () {
            // Don't refresh the page!
            event.preventDefault();

            //  Captureg new train info.
            trainName = $("#train-name-input").val().trim(); //Trim unecessary spaces
            trainDestination = $("#destination-input").val().trim();
            trainFrequency = $("#frequency-input").val().trim();
            firstTrainTime = $("#first-train-time-input").val().trim();
            // Store new train info object
            var newTrain = {
              name: trainName,
              dest: trainDestination,
              frequency: trainFrequency,
              nextTime: firstTrainTime

            }
            // Write new entry to database
            db.ref().push(newTrain);

            console.log("Name: " + name.trainName);
            console.log("Dest: " + dest.trainDestination);
            console.log("Freq: " + frequency.trainFrequency);
            console.log("Next Train: " + nextTime.firsttrainTime);




          });
          database.ref().on("child_added", function (childSnapshot) {
            //calculations needed
            var firstTimeConverted = moment(childSnapshot.val().firstTrain, "hh:mm").subtract(1, "days");
            var timeDiff = moment().diff(moment(firstTimeConverted), "minutes");
            //console.log("Difference in time: " + timeDiff);
            var remainder = timeDiff % childSnapshot.val().frequency;
            //console.log("Remainder: " + remainder);
            var minsUntilTrain = childSnapshot.val().frequency - remainder;
            //console.log("Time till Train: " + minsUntilTrain);
            var nextTrainTime = moment().add(minsUntilTrain, "minutes");
            //console.log("Next arrival: " + moment(nextTrainTime).format("hh:mm"));

            // Add each train's data into the table
            $("#schedule > tbody").append("<tr><td>" + childSnapshot.val().trainName + "</td><td>" + childSnapshot.val().destination + "</td><td>" +
              childSnapshot.val().frequency + "</td><td>" + moment(nextTrainTime).format("hh:mm") + "</td><td>" + minsUntilTrain + "</td></tr>");

        </script>
</body>

</html>